<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø³Ø¹Ø± ØµØ±Ù Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
:root {
    --bg: #f2f4f7;
    --card: #ffffff;
    --text: #1f2933;
    --green: #16a34a;
    --red: #dc2626;
}

body.dark {
    --bg: #0f172a;
    --card: #1e293b;
    --text: #e5e7eb;
}

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    direction: rtl;
    text-align: center;
}

header {
    background: linear-gradient(135deg,#2563eb,#1e40af);
    color: white;
    padding: 20px;
    font-size: 22px;
}

.container {
    padding: 20px;
}

.controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

button {
    border: none;
    padding: 10px 14px;
    border-radius: 10px;
    font-size: 14px;
    cursor: pointer;
}

.refresh { background: #22c55e; color: white; }
.darkmode { background: #334155; color: white; }
.convert { background: #f59e0b; color: white; }

.card {
    background: var(--card);
    max-width: 380px;
    margin: 15px auto;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
}

.title {
    font-size: 17px;
    margin-bottom: 10px;
}

.price {
    font-size: 26px;
    font-weight: bold;
}

.up { color: var(--green); }
.down { color: var(--red); }

.update {
    margin-top: 15px;
    font-size: 13px;
    opacity: 0.8;
}

footer {
    font-size: 12px;
    padding: 15px;
    opacity: 0.7;
}

input, select {
    padding: 8px;
    margin: 5px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
}
canvas { max-width: 100%; margin: 15px auto; }
</style>
</head>
<body>

<header>ğŸ’± Ø³Ø¹Ø± ØµØ±Ù Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</header>

<div class="container">

<div class="controls">
    <button class="refresh" onclick="fetchRates()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
    <button class="darkmode" onclick="toggleDark()">ğŸŒ™ ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</button>
</div>

<!-- Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Øª -->
<div class="card">
    <div class="title">ğŸ‡ºğŸ‡¸ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± â†’ ğŸ‡¸ğŸ‡¾ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</div>
    <div class="price" id="usd_syp">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<div class="card">
    <div class="title">ğŸ‡¹ğŸ‡· Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„ØªØ±ÙƒÙŠØ© â†’ ğŸ‡¸ğŸ‡¾ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ©</div>
    <div class="price" id="try_syp">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<div class="update" id="last_update"></div>

<!-- Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª -->
<div class="card">
    <div class="title">ğŸ’± Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div>
    <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" value="1">
    <select id="from_currency">
        <option value="USD">Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ğŸ‡ºğŸ‡¸</option>
        <option value="TRY">Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„ØªØ±ÙƒÙŠØ© ğŸ‡¹ğŸ‡·</option>
        <option value="SYP">Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© ğŸ‡¸ğŸ‡¾</option>
    </select>
    <select id="to_currency">
        <option value="USD">Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ğŸ‡ºğŸ‡¸</option>
        <option value="TRY">Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„ØªØ±ÙƒÙŠØ© ğŸ‡¹ğŸ‡·</option>
        <option value="SYP">Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø³ÙˆØ±ÙŠØ© ğŸ‡¸ğŸ‡¾</option>
    </select>
    <button class="convert" onclick="convertCurrency()">ØªØ­ÙˆÙŠÙ„ ğŸ”„</button>
    <div id="conversion_result"></div>
</div>

<!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
<div class="card">
    <div class="title">ğŸ“Š Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©</div>
    <canvas id="usd_chart"></canvas>
</div>

</div>

<footer>
Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙ‚Ø±ÙŠØ¨ÙŠØ© â€“ Ù„Ø£ØºØ±Ø§Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠØ© ÙÙ‚Ø·
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let lastUsd = null;
let lastTry = null;
let usdHistory = [];

// ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ
function toggleDark() {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkmode", document.body.classList.contains("dark"));
}
if (localStorage.getItem("darkmode") === "true") document.body.classList.add("dark");

// Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
async function fetchRates() {
    try {
        const res = await fetch("https://open.er-api.com/v6/latest/USD");
        const data = await res.json();

        const usd = data.rates.SYP;
        const tryRate = data.rates.TRY;
        const trySyp = usd / tryRate;

        setPrice("usd_syp", usd, lastUsd);
        setPrice("try_syp", trySyp, lastTry);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
        document.getElementById("last_update").innerText =
            "â±ï¸ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: " + new Date().toLocaleTimeString();

        // Ø³Ø¬Ù„ Ù„Ù„ØªØ§Ø±ÙŠØ®
        usdHistory.push({time: new Date().toLocaleTimeString(), value: usd});
        if (usdHistory.length > 24) usdHistory.shift(); // Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©
        drawChart();

        // Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ø³Ø¹Ø±
        notifyChange(usd, lastUsd);

        lastUsd = usd;
        lastTry = trySyp;

    } catch {
        document.getElementById("usd_syp").innerText = "Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        document.getElementById("try_syp").innerText = "Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
fetchRates();
setInterval(fetchRates, 60000);

// Ø¶Ø¨Ø· Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø¹ Ø§Ù„Ø£Ø³Ù‡Ù…
function setPrice(id, value, last) {
    const el = document.getElementById(id);
    let cls = "", arrow = "";
    if (last !== null) {
        if (value > last) { cls = "up"; arrow = " â¬†ï¸"; }
        if (value < last) { cls = "down"; arrow = " â¬‡ï¸"; }
    }
    el.className = "price " + cls;
    el.innerText = value.toLocaleString(undefined,{maximumFractionDigits:2}) + " Ù„.Ø³" + arrow;
}

// Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
function convertCurrency() {
    const amount = parseFloat(document.getElementById("amount").value);
    const from = document.getElementById("from_currency").value;
    const to = document.getElementById("to_currency").value;

    let usd = lastUsd, trySypRate = lastTry;
    let result = amount;

    if (from === "USD") result = amount * usd;
    if (from === "TRY") result = amount * trySypRate;
    if (from === "SYP") result = amount;

    if (to === "USD") result = (from==="USD"? amount : result / usd);
    if (to === "TRY") result = (from==="TRY"? amount : result / trySypRate);
    if (to === "SYP") result = result;

    document.getElementById("conversion_result").innerText =
        `${amount} ${from} = ${result.toLocaleString(undefined,{maximumFractionDigits:2})} ${to}`;
}

// Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ
function drawChart() {
    const ctx = document.getElementById('usd_chart').getContext('2d');
    if(window.usdChart) window.usdChart.destroy();
    window.usdChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: usdHistory.map(e => e.time),
            datasets: [{
                label: 'USD â†’ SYP',
                data: usdHistory.map(e => e.value),
                borderColor: '#2563eb',
                backgroundColor: 'rgba(37,99,235,0.2)',
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: false } }
        }
    });
}

// Ø¥Ø´Ø¹Ø§Ø± ØªØºÙŠØ± Ø§Ù„Ø³Ø¹Ø±
function notifyChange(current, last) {
    if (!("Notification" in window)) return;
    if (last === null || current === last) return;
    if (Notification.permission === "granted") {
        new Notification("Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ØªØºÙŠØ±!", {
            body: `Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${current.toLocaleString(undefined,{maximumFractionDigits:2})} Ù„.Ø³`
        });
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission();
    }
}
</script>

</body>
</html>
